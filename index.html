<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Toâ€‘Do List (Working)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap">
  <style>
    :root {
  --primary: 124, 249, 255;
  --secondary: 166, 108, 255;
  --background: 255, 255, 255;   /* light bg */
  --surface: 245, 245, 245;      /* light surface */
  --text: 0, 0, 0;               /* dark text */
  --text-secondary: 80, 80, 80;
}

.dark {
  --background: 15, 18, 38;      /* dark bg */
  --surface: 26, 31, 58;
  --text: 255, 255, 255;
  --text-secondary: 160, 174, 192;
}

    body { font-family: 'Inter', sans-serif; background: rgb(var(--background)); color: rgb(var(--text)); min-height: 100vh; overflow-x: hidden; }
    .glass { background: rgba(var(--surface), 0.6); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(var(--primary), 0.1); }
    .glass-light { background: rgba(255,255,255,.8); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(0,0,0,.05); }
    .title-font { font-family: 'Space Grotesk', sans-serif; }
    .glow-hover:hover { box-shadow: 0 0 15px rgba(var(--primary), .3); }
    .task-card { transition: all .2s ease; }
    .task-card:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,.1); }
    .priority-low{border-left:4px solid #4ade80}.priority-medium{border-left:4px solid #fbbf24}.priority-high{border-left:4px solid #f87171}
    .checkbox-container{position:relative;width:24px;height:24px}
    .checkbox-container input{position:absolute;opacity:0;width:0;height:0}
    .checkmark{position:absolute;top:0;left:0;width:24px;height:24px;border-radius:6px;border:2px solid rgba(var(--primary), .5);transition:all .2s}
    .checkbox-container input:checked~.checkmark{background-color:rgba(var(--primary),.2);border-color:rgba(var(--primary),1)}
    .checkmark:after{content:"";position:absolute;display:none;left:7px;top:3px;width:5px;height:10px;border:solid rgba(var(--primary),1);border-width:0 2px 2px 0;transform:rotate(45deg)}
    .checkbox-container input:checked~.checkmark:after{display:block}
    .confetti{position:absolute;width:10px;height:10px;background-color:rgba(var(--primary),.8);border-radius:50%;animation:confetti-fall 1s ease-out forwards}
    @keyframes confetti-fall{0%{transform:translateY(0) rotate(0);opacity:1}100%{transform:translateY(200px) rotate(360deg);opacity:0}}
    .progress-ring{transform:rotate(-90deg)}
    .bottom-sheet{position:fixed;bottom:0;left:0;right:0;z-index:50;border-radius:1.5rem 1.5rem 0 0;box-shadow:0 -10px 25px rgba(0,0,0,.1)}
    .drag-handle{width:40px;height:4px;background-color:rgba(255,255,255,.2);border-radius:2px;margin:12px auto}
    #particles-js{position:fixed;width:100%;height:100%;z-index:-1;opacity:.2}
    .gradient-bg{position:fixed;inset:0;z-index:-1;background:linear-gradient(-45deg, rgba(var(--primary),.05), rgba(var(--secondary),.05), rgba(124,58,237,.05), rgba(236,72,153,.05));background-size:400% 400%;animation:gradient 15s ease infinite}
    @keyframes gradient{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    ::-webkit-scrollbar{width:8px}::-webkit-scrollbar-track{background:rgba(var(--surface),.5);border-radius:10px}::-webkit-scrollbar-thumb{background:rgba(var(--primary),.5);border-radius:10px}::-webkit-scrollbar-thumb:hover{background:rgba(var(--primary),.7)}
    .tag{transition:all .2s ease}.tag:hover{transform:scale(1.05)}
    .tag.selected{outline:2px solid rgba(var(--primary),1)}
    .sidebar{transition:transform .3s ease}
    @media(max-width:768px){.sidebar{transform:translateX(-100%)}.sidebar.open{transform:translateX(0)}.sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:40}.sidebar-overlay.open{display:block}}
  </style>
</head>
<body class="dark:bg-gray-900">
  <div class="gradient-bg"></div>
  <div id="particles-js"></div>

  <div class="container mx-auto px-4 py-6 max-w-6xl">
    <header class="flex justify-between items-center mb-8">
      <div class="flex items-center">
        <button id="sidebar-toggle" class="mr-4 md:hidden" aria-label="Toggle sidebar">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
        </button>
        <h1 class="title-font text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-purple-500">To-Do-List</h1>
      </div>
      <div class="flex items-center space-x-4">
        <div class="relative">
          <input id="search" type="text" placeholder="Search tasks..." class="glass px-4 py-2 rounded-xl w-40 md:w-64 focus:w-64 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-cyan-400">
          <div class="absolute right-3 top-2.5 text-gray-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
          </div>
        </div>
        <button id="theme-toggle" class="glass p-2 rounded-xl hover:glow-hover" aria-label="Toggle theme">
          <svg id="dark-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>
          <svg id="light-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg>
        </button>
        <button id="settings-toggle" class="glass p-2 rounded-xl hover:glow-hover" aria-haspopup="dialog" aria-controls="settings-modal">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
        </button>
      </div>
    </header>

    <div class="flex flex-col md:flex-row gap-6">
      <div id="sidebar" class="sidebar glass hidden md:block w-64 rounded-xl p-4 flex-shrink-0">
        <div class="mb-8">
          <button id="add-task-btn" class="w-full bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white font-medium py-2.5 px-4 rounded-xl flex items-center justify-center space-x-2 transition-all hover:shadow-lg">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v12M6 12h12"/></svg>
            <span>New Task</span>
          </button>
        </div>
        <nav>
          <ul class="space-y-2">
            <li><button data-filter="all" class="filter-btn w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800/50 flex items-center space-x-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2"/></svg><span>All Tasks</span></button></li>
            <li><button data-filter="today" class="filter-btn w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800/50 flex items-center space-x-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><span>Today</span></button></li>
            <li><button data-filter="upcoming" class="filter-btn w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800/50 flex items-center space-x-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><span>Upcoming</span></button></li>
            <li><button data-filter="completed" class="filter-btn w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800/50 flex items-center space-x-3"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg><span>Completed</span></button></li>
          </ul>
        </nav>

        <div class="mt-8">
          <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-2 px-4">Tags</h3>
          <ul class="space-y-1">
            <li><button class="tag-filter w-full text-left px-4 py-1.5 rounded-lg hover:bg-gray-800/50 flex items-center space-x-3" data-tag="Work"><span class="w-3 h-3 rounded-full bg-cyan-500"></span><span>Work</span></button></li>
            <li><button class="tag-filter w-full text-left px-4 py-1.5 rounded-lg hover:bg-gray-800/50 flex items-center space-x-3" data-tag="Personal"><span class="w-3 h-3 rounded-full bg-purple-500"></span><span>Personal</span></button></li>
            <li><button class="tag-filter w-full text-left px-4 py-1.5 rounded-lg hover:bg-gray-800/50 flex items-center space-x-3" data-tag="Health"><span class="w-3 h-3 rounded-full bg-pink-500"></span><span>Health</span></button></li>
            <li><button class="tag-filter w-full text-left px-4 py-1.5 rounded-lg hover:bg-gray-800/50 flex items-center space-x-3" data-tag="Learning"><span class="w-3 h-3 rounded-full bg-yellow-500"></span><span>Learning</span></button></li>
          </ul>
        </div>
      </div>

      <div id="sidebar-overlay" class="sidebar-overlay"></div>

      <div class="flex-1">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <div class="glass p-4 rounded-xl">
            <div class="flex justify-between items-center">
              <div>
                <p class="text-sm text-gray-400">Tasks Today</p>
                <h3 id="stat-today" class="text-2xl font-bold">0/0</h3>
              </div>
              <div class="relative w-12 h-12">
                <svg class="progress-ring w-12 h-12" viewBox="0 0 100 100">
                  <circle id="progress-circle" class="stroke-cyan-500" stroke-width="6" fill="transparent" r="40" cx="50" cy="50" stroke-dasharray="251.2 251.2" stroke-dashoffset="251.2"></circle>
                </svg>
                <span id="progress-label" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-sm font-medium">0%</span>
              </div>
            </div>
          </div>
          <div class="glass p-4 rounded-xl">
            <div class="flex justify-between items-center">
              <div>
                <p class="text-sm text-gray-400">Weekly Streak</p>
                <h3 id="stat-streak" class="text-2xl font-bold">0 days</h3>
              </div>
              <div class="text-cyan-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
              </div>
            </div>
          </div>
          <div class="glass p-4 rounded-xl">
            <div class="flex justify-between items-center">
              <div>
                <p class="text-sm text-gray-400">Completed</p>
                <h3 id="stat-completed" class="text-2xl font-bold">0</h3>
              </div>
              <div class="text-purple-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              </div>
            </div>
          </div>
        </div>

        <div class="flex justify-between items-center mb-4">
          <h2 class="title-font text-xl font-semibold">Tasks</h2>
          <div class="flex space-x-2">
            <button id="add-task-btn-top" class="glass px-3 py-2 rounded-lg hover:glow-hover flex items-center space-x-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v12M6 12h12"/></svg><span>Add</span></button>
          </div>
        </div>

        <div id="task-list" class="space-y-3"></div>
      </div>
    </div>
  </div>

  <!-- Add/Edit task bottom sheet -->
  <div id="add-task-sheet" class="bottom-sheet glass hidden">
    <div class="drag-handle"></div>
    <div class="p-6">
      <h3 id="sheet-title" class="title-font text-xl font-semibold mb-4">Add New Task</h3>
      <form id="task-form">
        <input type="hidden" id="edit-id" />
        <div class="mb-4">
          <label for="task-title" class="block text-sm font-medium mb-1">Task Title</label>
          <input type="text" id="task-title" class="w-full glass px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-400" placeholder="What needs to be done?" required />
        </div>
        <div class="mb-4">
          <label for="task-notes" class="block text-sm font-medium mb-1">Notes</label>
          <textarea id="task-notes" class="w-full glass px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-400" rows="2" placeholder="Additional details..."></textarea>
        </div>
        <div class="grid grid-cols-2 gap-4 mb-4">
          <div>
            <label for="task-due" class="block text-sm font-medium mb-1">Due Date</label>
            <input type="datetime-local" id="task-due" class="w-full glass px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-400" />
          </div>
          <div>
            <label for="task-priority" class="block text-sm font-medium mb-1">Priority</label>
            <select id="task-priority" class="w-full glass px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-400">
              <option value="none">None</option>
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
            </select>
          </div>
        </div>
        <div class="mb-6">
          <label class="block text-sm font-medium mb-2">Tags</label>
          <div id="tag-chooser" class="flex flex-wrap gap-2">
            <button type="button" class="tag text-xs px-3 py-1 bg-cyan-500/20 text-cyan-400 rounded-full">Work</button>
            <button type="button" class="tag text-xs px-3 py-1 bg-purple-500/20 text-purple-400 rounded-full">Personal</button>
            <button type="button" class="tag text-xs px-3 py-1 bg-pink-500/20 text-pink-400 rounded-full">Health</button>
            <button type="button" class="tag text-xs px-3 py-1 bg-yellow-500/20 text-yellow-400 rounded-full">Learning</button>
            <button type="button" class="tag text-xs px-3 py-1 bg-red-500/20 text-red-400 rounded-full">Urgent</button>
          </div>
        </div>
        <div class="flex justify-end space-x-3">
          <button type="button" id="cancel-task-btn" class="px-4 py-2 rounded-lg hover:bg-gray-800/50">Cancel</button>
          <button type="submit" class="bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white font-medium py-2 px-6 rounded-lg">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Snackbar -->
  <div id="snackbar" class="fixed bottom-4 left-1/2 -translate-x-1/2 glass px-6 py-3 rounded-lg flex items-center hidden"><span>Task deleted</span><button id="undo-btn" class="ml-4 text-cyan-400 font-medium">Undo</button></div>

  <!-- Settings modal -->
  <div id="settings-modal" class="fixed inset-0 z-50 hidden items-center justify-center">
    <div class="absolute inset-0 bg-black/50"></div>
    <div class="glass rounded-xl w-full max-w-md mx-4 relative z-10 p-6">
      <div class="flex justify-between items-center mb-6">
        <h3 class="title-font text-xl font-semibold">Settings</h3>
        <button id="close-settings" class="text-gray-400 hover:text-gray-200" aria-label="Close settings">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="space-y-6">
        <div>
          <h4 class="text-sm font-medium text-gray-400 mb-3">Appearance</h4>
          <div class="flex items-center justify-between mb-3">
            <span>Dark Mode</span>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" id="dark-mode-toggle" class="sr-only peer" checked>
              <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-500"></div>
            </label>
          </div>
          <div class="flex items-center justify-between mb-3">
            <span>Glass Effect</span>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" id="glass-effect-toggle" class="sr-only peer" checked>
              <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-500"></div>
            </label>
          </div>
          <div class="flex items-center justify-between">
            <span>Particle Background</span>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" id="particles-toggle" class="sr-only peer" checked>
              <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-500"></div>
            </label>
          </div>
        </div>
        <div>
          <h4 class="text-sm font-medium text-gray-400 mb-3">Notifications</h4>
          <div class="flex items-center justify-between mb-3">
            <span>Task Reminders</span>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" id="reminders-toggle" class="sr-only peer" checked>
              <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-500"></div>
            </label>
          </div>
          <div class="flex items-center justify-between">
            <span>Completion Sounds</span>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" id="sounds-toggle" class="sr-only peer" checked>
              <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-500"></div>
            </label>
          </div>
        </div>
        <div>
          <h4 class="text-sm font-medium text-gray-400 mb-3">Task Completion</h4>
          <div class="flex items-center justify-between mb-3">
            <span>Confetti Effect</span>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" id="confetti-toggle" class="sr-only peer" checked>
              <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-500"></div>
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== State ======
    const state = {
      tasks: [],
      filter: { type: 'all', tag: null, q: '' },
      lastDeleted: null,
    };

    // Sample tasks (only used on first load)
    const SAMPLE = [
      { id: id(), title: 'Complete project proposal', notes: 'Finish the proposal for the new client project', priority: 'high', due: new Date(Date.now()).setHours(15,0,0,0), tags: ['Work','Urgent'], done: false, createdAt: Date.now() },
      { id: id(), title: 'Grocery shopping', notes: 'Buy milk, eggs, bread, and vegetables', priority: 'medium', due: Date.now() + 24*3600*1000, tags: ['Personal'], done: false, createdAt: Date.now() },
      { id: id(), title: 'Morning workout', notes: '30 minutes cardio + strength', priority: 'low', due: Date.now(), tags: ['Health'], done: true, doneAt: Date.now(), createdAt: Date.now() },
      { id: id(), title: 'Read new JavaScript framework docs', notes: 'Check out the new features in the latest release', priority: 'none', due: null, tags: ['Learning'], done: false, createdAt: Date.now() },
    ];

    // ====== DOM ======
    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));

    // Elements
    const sidebarToggle = $('#sidebar-toggle');
    const sidebar = $('#sidebar');
    const sidebarOverlay = $('#sidebar-overlay');
    const themeToggle = $('#theme-toggle');
    const darkIcon = $('#dark-icon');
    const lightIcon = $('#light-icon');
    const settingsToggle = $('#settings-toggle');
    const settingsModal = $('#settings-modal');
    const closeSettings = $('#close-settings');
    const addTaskBtn = $('#add-task-btn');
    const addTaskBtnTop = $('#add-task-btn-top');
    const addTaskSheet = $('#add-task-sheet');
    const cancelTaskBtn = $('#cancel-task-btn');
    const taskForm = $('#task-form');
    const snackbar = $('#snackbar');
    const undoBtn = $('#undo-btn');
    const searchInput = $('#search');

    const statToday = $('#stat-today');
    const statCompleted = $('#stat-completed');
    const statStreak = $('#stat-streak');
    const progressCircle = $('#progress-circle');
    const progressLabel = $('#progress-label');

    const darkModeToggle = $('#dark-mode-toggle');
    const glassEffectToggle = $('#glass-effect-toggle');
    const particlesToggle = $('#particles-toggle');
    const remindersToggle = $('#reminders-toggle');
    const soundsToggle = $('#sounds-toggle');
    const confettiToggle = $('#confetti-toggle');

    // ====== Init ======
    document.addEventListener('DOMContentLoaded', () => {
      loadData();
      loadSettings();
      render();
      if (particlesToggle?.checked) initParticles();
      wireEvents();
    });

    function loadData(){
      const saved = localStorage.getItem('To-Do-List_tasks');
      state.tasks = saved ? revive(JSON.parse(saved)) : SAMPLE;
      persist(); // ensure structure saved
    }
    function persist(){ localStorage.setItem('To-Do-List_tasks', JSON.stringify(state.tasks)); }

    function revive(rows){
      return rows.map(t => ({ ...t, due: t.due==null?null:+t.due }));
    }

    // ====== Rendering ======
    function render(){
      const list = $('#task-list');
      list.innerHTML = '';
      const tasks = filtered();
      tasks.forEach(task => list.appendChild(taskNode(task)));
      updateStats();
    }

    function filtered(){
      const q = state.filter.q.toLowerCase();
      const now = new Date(); now.setHours(0,0,0,0);
      return state.tasks.filter(t => {
        let ok = true;
        if (state.filter.type === 'today') {
          if (!t.due) ok = false; else { const d = new Date(+t.due); d.setHours(0,0,0,0); ok = d.getTime() === now.getTime(); }
        }
        if (state.filter.type === 'upcoming') {
          if (!t.due) ok = false; else { const d = new Date(+t.due); d.setHours(0,0,0,0); ok = d > now; }
        }
        if (state.filter.type === 'completed') ok = t.done;
        if (state.filter.tag) ok = ok && (t.tags||[]).includes(state.filter.tag);
        if (q) ok = ok && (t.title.toLowerCase().includes(q) || (t.notes||'').toLowerCase().includes(q));
        return ok;
      });
    }

    function taskNode(t){
      const wrap = document.createElement('div');
      wrap.className = `task-card glass rounded-xl p-4 hover:shadow-md relative ${t.priority!=='none' ? 'priority-'+t.priority : ''}`;
      wrap.dataset.id = t.id;

      const dueText = formatDue(t);
      const badge = priorityBadge(t.priority);
      const tagsHtml = (t.tags||[]).map(tag => `<span class="tag text-xs px-2 py-1 ${tagColor(tag)} rounded-full">${tag}</span>`).join('');

      wrap.innerHTML = `
        <div class="flex items-start">
          <label class="checkbox-container mr-3 mt-1">
            <input type="checkbox" class="task-checkbox" ${t.done?'checked':''}>
            <span class="checkmark"></span>
          </label>
          <div class="flex-1">
            <div class="flex justify-between items-start">
              <div>
                <h3 class="font-medium ${t.done?'line-through text-gray-500':''}">${escapeHtml(t.title)}</h3>
                <p class="text-sm ${t.done?'text-gray-500':'text-gray-400'} mt-1">${t.done?'Completed':dueText}</p>
              </div>
              <div class="flex items-center space-x-2">
                ${badge}
                <button class="text-gray-400 hover:text-gray-200 task-menu" aria-label="Open task menu">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h.01M12 12h.01M19 12h.01"/></svg>
                </button>
              </div>
            </div>
            ${tagsHtml?`<div class="mt-2 flex flex-wrap gap-2">${tagsHtml}</div>`:''}
          </div>
        </div>`;

      return wrap;
    }

    function formatDue(task){
      if (!task.due) return 'No due date';
      const d = new Date(+task.due);
      const today = new Date(); today.setHours(0,0,0,0);
      const dueDay = new Date(d); dueDay.setHours(0,0,0,0);
      if (dueDay.getTime() === today.getTime()) return `Due today at ${d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}`;
      if (dueDay < today) return `Overdue since ${d.toLocaleDateString()}`;
      return `Due ${d.toLocaleDateString()}`;
    }

    function priorityBadge(p){
      if (p==='none') return '';
      const map = { low:'bg-green-500/20 text-green-400', medium:'bg-yellow-500/20 text-yellow-400', high:'bg-red-500/20 text-red-400' };
      const txt = p[0].toUpperCase()+p.slice(1);
      return `<span class="text-xs px-2 py-1 ${map[p]} rounded-full">${txt}</span>`;
    }

    function tagColor(tag){
      const map = { Work:'bg-cyan-500/20 text-cyan-400', Personal:'bg-purple-500/20 text-purple-400', Health:'bg-pink-500/20 text-pink-400', Learning:'bg-yellow-500/20 text-yellow-400', Urgent:'bg-red-500/20 text-red-400' };
      return map[tag] || 'bg-gray-500/20 text-gray-300';
    }

    // ====== Events ======
    function wireEvents(){
      // Sidebar mobile
      sidebarToggle?.addEventListener('click', ()=>{ sidebar.classList.toggle('open'); sidebarOverlay.classList.toggle('open'); });
      sidebarOverlay?.addEventListener('click', ()=>{ sidebar.classList.remove('open'); sidebarOverlay.classList.remove('open'); });

      // Filters
      $$('.filter-btn').forEach(btn=>btn.addEventListener('click', ()=>{ state.filter.type = btn.dataset.filter; render(); }));
      $$('.tag-filter').forEach(btn=>btn.addEventListener('click', ()=>{ state.filter.tag = btn.dataset.tag; render(); }));

      // Search
      searchInput.addEventListener('input', (e)=>{ state.filter.q = e.target.value; render(); });

      // Theme and settings
      themeToggle.addEventListener('click', toggleTheme);
      settingsToggle.addEventListener('click', ()=> settingsModal.classList.remove('hidden'));
      closeSettings.addEventListener('click', ()=> settingsModal.classList.add('hidden'));

      darkModeToggle.addEventListener('change', ()=> setDark(darkModeToggle.checked));
      glassEffectToggle.addEventListener('change', toggleGlassEffect);
      particlesToggle.addEventListener('change', ()=> particlesToggle.checked ? initParticles() : (document.getElementById('particles-js').innerHTML=''));
      remindersToggle.addEventListener('change', ()=> localStorage.setItem('To-Do-List_reminders', remindersToggle.checked));
      soundsToggle.addEventListener('change', ()=> localStorage.setItem('To-Do-List_sounds', soundsToggle.checked));
      confettiToggle.addEventListener('change', ()=> localStorage.setItem('To-Do-List_confetti', confettiToggle.checked));

      // Add / Edit
      const openSheet = ()=>{ addTaskSheet.classList.remove('hidden'); };
      addTaskBtn.addEventListener('click', ()=>{ resetForm(); openSheet(); });
      addTaskBtnTop.addEventListener('click', ()=>{ resetForm(); openSheet(); });
      cancelTaskBtn.addEventListener('click', ()=> addTaskSheet.classList.add('hidden'));

      // Tag select in form
      $('#tag-chooser').addEventListener('click', (e)=>{
        const b = e.target.closest('button.tag'); if(!b) return; b.classList.toggle('selected');
      });

      // Submit form
      taskForm.addEventListener('submit', e=>{
        e.preventDefault();
        const idInput = $('#edit-id').value;
        const t = collectForm();
        if (idInput) {
          // edit
          const idx = state.tasks.findIndex(x=>x.id===idInput);
          if (idx>-1) state.tasks[idx] = { ...state.tasks[idx], ...t };
        } else {
          state.tasks.unshift({ ...t, id:id(), createdAt: Date.now(), done:false });
        }
        persist();
        render();
        addTaskSheet.classList.add('hidden');
        taskForm.reset();
      });

      // Task list delegation (checkbox, menu)
      $('#task-list').addEventListener('change', (e)=>{
        if (e.target.matches('.task-checkbox')){
          const id = e.target.closest('.task-card').dataset.id;
          const task = state.tasks.find(t=>t.id===id);
          if (!task) return;
          task.done = e.target.checked;
          task.doneAt = task.done ? Date.now() : null;
          persist();
          if (task.done && confettiToggle.checked) createConfetti(e.target);
          if (task.done && soundsToggle.checked) beep();
          render();
        }
      });

      $('#task-list').addEventListener('click', (e)=>{
        const menuBtn = e.target.closest('.task-menu');
        if (menuBtn){
          const card = menuBtn.closest('.task-card');
          openQuickMenu(card.dataset.id);
        }
      });

      // Undo
      undoBtn.addEventListener('click', ()=>{
        if (state.lastDeleted){ state.tasks.unshift(state.lastDeleted); state.lastDeleted=null; persist(); render(); hideSnackbar(); }
      });
    }

    // ====== Quick Menu (Edit/Delete) ======
    function openQuickMenu(id){
      const t = state.tasks.find(x=>x.id===id); if (!t) return;
      const choice = prompt('Type: e = edit, d = delete', 'e');
      if (!choice) return;
      if (choice.toLowerCase()==='e') {
        // load into form
        $('#sheet-title').textContent = 'Edit Task';
        $('#edit-id').value = t.id;
        $('#task-title').value = t.title;
        $('#task-notes').value = t.notes||'';
        $('#task-priority').value = t.priority||'none';
        $('#task-due').value = t.due ? new Date(+t.due).toISOString().slice(0,16) : '';
        // tags
        $$('#tag-chooser .tag').forEach(btn=>{ const tag = btn.textContent.trim(); btn.classList.toggle('selected', (t.tags||[]).includes(tag)); });
        addTaskSheet.classList.remove('hidden');
      } else if (choice.toLowerCase()==='d') {
        state.lastDeleted = t;
        state.tasks = state.tasks.filter(x=>x.id!==id);
        persist(); render();
        showSnackbar('Task deleted');
      }
    }

    function showSnackbar(msg){
      snackbar.querySelector('span').textContent = msg;
      snackbar.classList.remove('hidden');
      clearTimeout(showSnackbar._t);
      showSnackbar._t = setTimeout(()=> hideSnackbar(), 5000);
    }
    function hideSnackbar(){ snackbar.classList.add('hidden'); }

    // ====== Form helpers ======
    function resetForm(){
      $('#sheet-title').textContent = 'Add New Task';
      $('#edit-id').value = '';
      taskForm.reset();
      $$('#tag-chooser .tag').forEach(b=> b.classList.remove('selected'));
    }
    function collectForm(){
      const tags = $$('#tag-chooser .tag.selected').map(b=>b.textContent.trim());
      const dueVal = $('#task-due').value ? new Date($('#task-due').value).getTime() : null;
      return { title: $('#task-title').value.trim(), notes: $('#task-notes').value.trim(), priority: $('#task-priority').value, due: dueVal, tags };
    }

    // ====== Stats ======
    function updateStats(){
      const today = new Date(); today.setHours(0,0,0,0);
      const todays = state.tasks.filter(t=> t.due && (new Date(+t.due).setHours(0,0,0,0)===today.getTime()) );
      const doneToday = todays.filter(t=> t.done).length;
      statToday.textContent = `${doneToday}/${todays.length}`;

      const completed = state.tasks.filter(t=> t.done).length;
      statCompleted.textContent = completed;

      // Streak: count distinct days in last 7 with any completion
      const days = new Set( state.tasks.filter(t=> t.doneAt).map(t=> new Date(t.doneAt).toDateString()) );
      statStreak.textContent = `${Math.min(days.size,7)} days`;

      // Progress ring (today)
      const pct = todays.length? Math.round(doneToday/todays.length*100) : 0;
      const circumference = 2*Math.PI*40; // r=40
      progressCircle.setAttribute('stroke-dasharray', `${circumference} ${circumference}`);
      progressCircle.setAttribute('stroke-dashoffset', `${circumference - pct/100*circumference}`);
      progressLabel.textContent = `${pct}%`;
    }

    // ====== Settings / Theme ======
    function loadSettings(){
      const theme = localStorage.getItem('To-Do-List_theme');
  if (theme === 'light') setDark(false);
  else setDark(true); // default dark
      const glass = localStorage.getItem('To-Do-List_glass');
      const parts = localStorage.getItem('To-Do-List_particles');
      const remind = localStorage.getItem('To-Do-List_reminders');
      const sound = localStorage.getItem('To-Do-List_sounds');
      const conf = localStorage.getItem('To-Do-List_confetti');

      if (theme==='light') setDark(false); else setDark(true);
      if (glass==='false') glassEffectToggle.checked=false, toggleGlassEffect();
      if (parts==='false') particlesToggle.checked=false;
      remindersToggle.checked = remind !== 'false';
      soundsToggle.checked = sound !== 'false';
      confettiToggle.checked = conf !== 'false';
    }

    function toggleTheme(){ setDark(!document.documentElement.classList.contains('dark')); }
    function setDark(on) {
  const html = document.documentElement;
  if (on) {
    html.classList.add('dark');
    darkIcon.classList.add('hidden');
    lightIcon.classList.remove('hidden');
    localStorage.setItem('To-Do-List_theme', 'dark');
    darkModeToggle.checked = true;
  } else {
    html.classList.remove('dark');
    darkIcon.classList.remove('hidden');
    lightIcon.classList.add('hidden');
    localStorage.setItem('To-Do-List_theme', 'light');
    darkModeToggle.checked = false;
  }
}


    function toggleGlassEffect(){
      const els = $$('.glass');
      els.forEach(el=> glassEffectToggle.checked ? el.classList.remove('glass-light') : el.classList.add('glass-light'));
      localStorage.setItem('To-Do-List_glass', glassEffectToggle.checked);
    }

    function initParticles(){
      const box = document.getElementById('particles-js');
      if (!box) return; box.innerHTML='';
      for (let i=0;i<30;i++){
        const p = document.createElement('div');
        p.className = 'absolute rounded-full bg-white';
        const size = 1 + Math.random()*5; p.style.width = p.style.height = size+'px';
        p.style.left = Math.random()*100+'%'; p.style.top = Math.random()*100+'%'; p.style.opacity = .1 + Math.random()*.5;
        const dx = Math.random()*200-100, dy = Math.random()*200-100; const dur = 10 + Math.random()*20;
        const kf = document.createElement('style');
        const name = `float_${Math.random().toString(36).slice(2)}`;
        kf.innerHTML = `@keyframes ${name}{0%{transform:translate(0,0)}100%{transform:translate(${dx}px,${dy}px)}}`;
        document.head.appendChild(kf);
        p.style.animation = `${name} ${dur}s infinite alternate linear`;
        box.appendChild(p);
      }
    }

    // ====== Effects ======
    function createConfetti(originEl){
      const rect = originEl.getBoundingClientRect();
      const x = rect.left + rect.width/2, y = rect.top + rect.height/2;
      for (let i=0;i<20;i++){
        const c = document.createElement('div');
        c.className = 'confetti';
        c.style.left = x+'px'; c.style.top = y+'px';
        c.style.backgroundColor = `hsl(${Math.random()*360},100%,70%)`;
        c.style.width = c.style.height = (4+Math.random()*8)+'px';
        c.style.animationDuration = (.5+Math.random()*.5)+'s';
        c.style.animationDelay = (Math.random()*.2)+'s';
        document.body.appendChild(c);
        setTimeout(()=> c.remove(), 1000);
      }
    }

    // Lightweight beep using Web Audio (no base64 needed)
    function beep(){
      try {
        const ctx = new (window.AudioContext||window.webkitAudioContext)();
        const o = ctx.createOscillator(); const g = ctx.createGain();
        o.type='sine'; o.frequency.value = 880; g.gain.value = 0.05; o.connect(g); g.connect(ctx.destination); o.start();
        setTimeout(()=>{ o.stop(); ctx.close(); }, 120);
      } catch(e) {}
    }

    // ====== Utils ======
    function id(){ return Date.now().toString(36)+Math.random().toString(36).slice(2,8); }
    function escapeHtml(s=''){ return s.replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;' }[c])); }
  </script>
      <p class="copyright">Copyright &copy; 2025 To_Do_List By Nitesh. All rights reserved.</p>
      <style>
  .copyright {
    position: fixed;
    bottom: 5px;     /* distance from bottom */
    right: 10px;      /* distance from right */
    font-size: 10px;
    color: #666;
    color: rgba(255,255,255,0.6); /* soft gray-white */
    z-index: 50;    /* stays above background */
  }
</style>
</body>
</html>

